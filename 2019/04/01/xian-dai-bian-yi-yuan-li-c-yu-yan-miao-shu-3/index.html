<!DOCTYPE HTML>
<html lang="zh-CN">


<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    <meta name="keywords" content="《现代编译原理-C语言描述》（3）- 语法分析, Algorithm">
    <meta name="description" content>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>《现代编译原理-C语言描述》（3）- 语法分析 | Jason Jin</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>


<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">Jason Jin</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">Jason Jin</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/Jinzhengxu" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/Jinzhengxu" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    
<script src="/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('请输入访问本文章的密码')).toString(CryptoJS.enc.Hex)) {
                alert('密码错误，将返回主页！');
                location.href = '/';
            }
        }
    })();
</script>




<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/1.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">《现代编译原理-C语言描述》（3）- 语法分析</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        height: calc(100vh - 250px);
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/编译原理/">
                                <span class="chip bg-color">编译原理</span>
                            </a>
                        
                            <a href="/tags/虎书/">
                                <span class="chip bg-color">虎书</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/底层/" class="post-category">
                                底层
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2019-04-01
                </div>
                

                

                

                

                
            </div>
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <h3 id="第三章-语法分析"><a href="#第三章-语法分析" class="headerlink" title="第三章 语法分析"></a>第三章 语法分析</h3><blockquote>
<p>语法(syn-tax):组合单词以形成词组,从句或句子的方法。<br>—-韦氏词典</p>
</blockquote>
<p><strong>* 一个状态数为N的自动机无法记忆嵌套深度大于N的括号 *</strong>,因为状态数为N的自动机一定会到达终态，并无法继续读入。词法分析器Lex实现上一章中的<code>digits</code>时，只要简单的用<code>digits</code>右部的式子<code>[0-9]+</code>来替换就可以了。但是这种方式对于下面给出的三个正则表达式却行不通：</p>
<pre><code>digits=[0-9]+
sum=expr&quot;+&quot;expr
expr=&quot;(&quot;sum&quot;)&quot;|digits</code></pre><p>我们可以尝试一下将expr中的sum替换掉<code>expr=&quot;(&quot;expr&quot;+&quot;expr&quot;)&quot;|digits</code>,但是如果继续用expr替换自身，右部依然会出现expr，并且数量会越来越多。</p>
<p>所以这种形式的缩写并不能增强正则表达式的语言描述能力（它并没有定义额外的语言），除非这种缩写形式是递归的。但是这种递归带来的额外的表达能力正是语法分析所需要的，一旦有了递归的缩写形式，则出来在表达式的顶层之外，可以不再需要可选操作。克林闭包也不再是必须的。</p>
<p>这样我们就得到了一种简单的表示法，称为上下文无关文法（context-free grammer）。事实上文法也可以用来描述词法单词的结构。但是我们需要比DFA更强大的方法来分析文法所描述的语言。</p>
<h4 id="上下文无关文法"><a href="#上下文无关文法" class="headerlink" title="上下文无关文法"></a>上下文无关文法</h4><p>对于语法分析而言：</p>
<pre><code>字符串---源程序
符号---词法单词
字母表---词法分析器返回的单词类型集合</code></pre><p>每一个符号或是终结符（terminal）（老子字母表中的单词），非终结符（nonterminal）（绝不会出现在产生式的左部）。还有一个开始符号。</p>
<p>文法3-1直线式程序的语法：<br><img src="https://s2.ax1x.com/2019/04/01/AyCHo9.png" alt="AyCHo9.png"></p>
<pre><code>终结符：id print num + ,（ ） := ；
非终结符：S E L</code></pre><p>由3-1写成的源程序</p>
<pre><code>a := 7;
b := c + (d := 5+ 6, d)</code></pre><p>其中名字<code>a，b，c，d</code>和数字是与其中一些单词相关联的语义值（semantic value）。</p>
<h5 id="推导"><a href="#推导" class="headerlink" title="推导"></a>推导</h5><p>derivation，从开始符号，对右部的每一个非终结符都用此非终结符对应的产生式中的一个右部来替换。<br><a href="https://imgchr.com/i/AyPaTJ" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/04/01/AyPaTJ.png" alt="AyPaTJ.png"></a><br>这里很容易想到一个句子可以存在多种不同的推导，其中有两种推导：</p>
<ul>
<li>最左推导（leftmost derivation）：是一种总是扩展最左边非终结符的推导</li>
<li>最右推导（rightmost derivation）：是一种总是扩展最右边非终结符的推导</li>
</ul>
<p>3-1既不是最左推导也不是最右推导</p>
<h5 id="语法分析树"><a href="#语法分析树" class="headerlink" title="语法分析树"></a>语法分析树</h5><p>parse tree，将推导中的各符号连接从他推导出来的符号<br><a href="https://imgchr.com/i/AyiY9I" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/04/01/AyiY9I.png" alt="AyiY9I.png"></a><br>如上图，两种不同的推导可以有相同的语法树。</p>
<h5 id="二义性语法"><a href="#二义性语法" class="headerlink" title="二义性语法"></a>二义性语法</h5><p>如果一个文法能够推导出两种不同语法树的句子，则该文法有二义性（ambiguous），句子有两颗语法分析树<br><a href="https://imgchr.com/i/AyiOKK" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/04/01/AyiOKK.png" alt="AyiOKK.png"></a><br>二义性文法会给编译带来问题，通常我们希望文法是无二义性的。二义性的文法通常也可以转换称无二义性的文法。</p>
<p>例如，文法3-2是一种而二义性的文法：<br><a href="https://imgchr.com/i/AyiOKK" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/04/01/AyiOKK.png" alt="AyiOKK.png"></a><br>我们假定<code>*</code>比<code>+</code>具有更紧密的约束，换言之，<code>*</code>具有较高的优先级。其次，假定每一种操作符都是左结合的，通过引入一个新的非终结符得到无二义性的文法3-3：<br><a href="https://imgchr.com/i/AyFaGR" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/04/01/AyFaGR.png" alt="AyFaGR.png"></a></p>
<pre><code>E---表达式expression
T---项term
F---因子factor</code></pre><p>如果我们想让<code>*</code>是右结合的，只要将表达式改写为$T \rightarrow F*T$即可。</p>
<p>这种方法可以消除一些语言的二义性，但是一些语言只有有二义性的文法。</p>
<h5 id="文件结束符"><a href="#文件结束符" class="headerlink" title="文件结束符"></a>文件结束符</h5><p>语法分析器不仅会读入终结符，也会读入文件结束标志我们用<code>$</code>来表示。为了指明<code>$</code>必须出现在一个完整的S词组之后，需要引入一个新的开始符号$ S’ $ 以及一个新的产生式$ S’ \rightarrow S＄$<br>例如文法3-4：<br><a href="https://imgchr.com/i/AykKTe" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/04/01/AykKTe.png" alt="AykKTe.png"></a></p>
<h4 id="预测分析"><a href="#预测分析" class="headerlink" title="预测分析"></a>预测分析</h4><p>有一些文法使用一种称为递归下降（recursive descent）的简单算法就很容易进行分析，这种方法的本质是将文法产生式传唤为递归函数中的一个字句。下面为文法3-5写一个递归下降文法分析器。文法3-5：<br><img src="https://s2.ax1x.com/2019/04/01/AyEqFe.png" alt="AyEqFe.png"><br>这个语言的递归下降语法分析器对每一个非终结符有一个函数，非终结符的每个产生式对应一个字句：</p>
<pre><code>enum token{IF,THEN,ELSE,PRINT,BEGIN,END,NUM,EQ,SEMI};
extern enum token getToken(void);

enum token tok;
void advance() {tok=getToken();}
void eat(enum token t){if(tok==t) advance();else error();}

void S(void){
    switch(tok){
        case IF: eat(IF);E();eat(THEN);S();
                             eat(ELSE); S(); break;
        case BEGIN:eat(BEGIN); S(); L(); break;
        case PRINT:eat(PRINT); E(); break;
        default: error();
    }
}

void L(void){
    switch(tok){
        case END: eat(END); break;
        case SEMI: eat(SEMI); S(); L(); break;
        default: error();
    }
}

voidE(void){
    eat(NUM); eat(EQ); eat(NUM);
}</code></pre><p>对于文法3-4：</p>
<pre><code>void S(void){ E(); eat(EOF);}
void E(void){
    switch(tok){
        case ?:E(); eat(PLUS); T(); break;
        case ?:E(); eat(MINUS); T(); break;
        case ?:T(); break;
        default: error();
    }
}

void T(void){
    switch(tok){
        case ?:T();eat(TIMES);F();break;
        case ?:T();eat(DIV); F(); break;
        case ?:F();break;
        default:error();
    }
}</code></pre><p>这事产生了一个冲突，函数E的前两个字句E并不知道该使用哪一个。</p>
<p>递归下降分析也称为预测（predictIve）分析，只适合于每个子表达式的第一个终结符号能够为产生式的选择提供足够信息的文法。</p>
<p>有时候使用分析器生成器并不方便，预测分析器的优点就在于我们可以使用它手工构造分析器。</p>
<h5 id="FIRST集合和FOLLOW集合"><a href="#FIRST集合和FOLLOW集合" class="headerlink" title="FIRST集合和FOLLOW集合"></a>FIRST集合和FOLLOW集合</h5><p>为了便于理解，下面我们形式化FIRST的概念，然后用一个简单的算法导出无冲突的递归下降语法分析器。</p>
<p>给定一个由终结符和非终结符组成的字符串 $\gamma$ ,FIRST( $\gamma$ ), 是可以从 $\gamma$中推导出的由终结符组成的字符串都必定以<code>id,num,(</code>开始。 因此有<br>$$<br>FIRST(T*F)={id,num,(}<br>$$<br>但是如果两个不同的产生式 $X \rightarrow \gamma_1$和 $X \rightarrow \gamma_2$具有相同的左部符号(X),并且它们的右部有重合的FIRST集合,则这个文法不能使用预测分析法来分析。</p>
<p>下面对文法3-6进行分析，文法3-6：<br><a href="https://imgchr.com/i/A6qDQH" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/04/02/A6qDQH.md.png" alt="A6qDQH.md.png"></a><br>对一个特定的文法，当给定由终结符和非终结符组成的字符串 $\gamma$时下列论述成立：</p>
<ul>
<li>若X可以导出空串，那么nullable（X）为真。</li>
<li>FIRST（$\gamma$）是可从$\gamma$推导出的字符串的开头终结符的集合。</li>
<li>FOLLOW（X）是可以直接跟随于X之后的终结符集合。也就是说<ul>
<li>如果存在着任意一推导包含 Xt，则$t \in FOLLOW(X)$<ul>
<li>当推导包含XYZt，其中Y和Z都推导出 $\epsilon$时，也有$t \in FOLLOW(X)$。</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>下面我们就可以给出计算字符串FIRST，FOLLOW，nullable集合的算法<br>    <img src="https://s2.ax1x.com/2019/04/02/A6LK0I.png" alt="A6LK0I.png"><br>计算这三个关系式时可不必同时计算，例如对于文法3-6，我们初始有：</p>
<table>
<thead>
<tr>
<th></th>
<th>nullable</th>
<th>FIRST</th>
<th>FOLLOW</th>
</tr>
</thead>
<tbody><tr>
<td>X</td>
<td>no</td>
<td></td>
<td></td>
</tr>
<tr>
<td>Y</td>
<td>no</td>
<td></td>
<td></td>
</tr>
<tr>
<td>Z</td>
<td>no</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>在第一次迭代中，我们可以发现关系产生了变化</p>
<table>
<thead>
<tr>
<th></th>
<th>nullable</th>
<th>FIRST</th>
<th>FOLLOW</th>
</tr>
</thead>
<tbody><tr>
<td>X</td>
<td>no</td>
<td>a</td>
<td>c d</td>
</tr>
<tr>
<td>Y</td>
<td>yes</td>
<td>c</td>
<td>d</td>
</tr>
<tr>
<td>Z</td>
<td>no</td>
<td>d</td>
<td></td>
</tr>
</tbody></table>
<p>在第二次迭代中我们可以发现X也是可以为空的。因此</p>
<table>
<thead>
<tr>
<th></th>
<th>nullable</th>
<th>FIRST</th>
<th>FOLLOW</th>
</tr>
</thead>
<tbody><tr>
<td>X</td>
<td>yes</td>
<td>a c</td>
<td>a c d</td>
</tr>
<tr>
<td>Y</td>
<td>yes</td>
<td>c</td>
<td>a c d</td>
</tr>
<tr>
<td>Z</td>
<td>no</td>
<td>a c d</td>
<td></td>
</tr>
</tbody></table>
<p>在第三次迭代中，没有新的信息，于是算法中止。</p>
<p>也可以将FIRST关系推广到符号串中：<br>$$<br>\begin{align}<br>&amp;FIRST(X\gamma)=FIRST[X] \qquad \qquad \qquad \qquad  若！nullable[X]\\<br>&amp;FIRST(X\gamma)=FIRST[X] \cup FIRST(\gamma) \qquad 若nullable[X]\\<br>\end{align}<br>$$</p>
<h5 id="构造预测分析器"><a href="#构造预测分析器" class="headerlink" title="构造预测分析器"></a>构造预测分析器</h5><p>下面来介绍一种较为简单的方法。可以让我们手工构造预测分析器。假设我们有一个递归下降分析器，如果能为每一个 $(X,T)$ ,选择正确的产生式.我们所需要的所有信息都可以由一张二维表表示，即预测分析表（predicative parsing table）。<br><img src="https://s2.ax1x.com/2019/04/07/AhXPDf.png" alt="AhXPDf.png"><br>上图的文法具有二义性,会导致预测分析器有多重定义的项，这样无法得到一个程序设计语言。</p>
<p>若文法不含多重定义的项，则称其为 $LL（1）$ 型文法， $LL（1）$ 代表 <strong><em>从左到右分析，最左推导和超前查看一个符号（Left-to-right parse,Leftmost-derivation，1-symbol lookhead）</em></strong> 。推广 $ FIRST $ 集合的概念，对于任何k，不存在任何有二义性的文法是<br>$ LL（k）$ 型文法，但是这样会预测分析表过于庞大，很少会采用这种方法，但有时在手工编写递归下降分析器时会遇到这样的情况。</p>
<h5 id="消除左递归"><a href="#消除左递归" class="headerlink" title="消除左递归"></a>消除左递归</h5><p>$$<br>\begin{align}<br>&amp; E \rightarrow E + T \\<br>&amp; E \rightarrow T<br>\end{align}<br>$$<br>会导致左递归（left recursion），具有左递归的文法不是 $LL（1）$ 型文法。为了消除左递归，我们可以用右递归来重写产生式，引入一个新的非终结符 $E’$ ,并将产生式重写为：</p>
<p>$$<br>\begin{align}<br>&amp; E \rightarrow T E’ \\<br>&amp; E \rightarrow +T E’ \\<br>&amp; E’ \rightarrow<br>\end{align}<br>$$</p>
<p>这样就获得了一个没有左递归的文法</p>
<h5 id="提取左因子"><a href="#提取左因子" class="headerlink" title="提取左因子"></a>提取左因子</h5><p>同左递归一样，<strong><em>当一个非终结符的的两个产生式以相同的符号开始时</em></strong> 会发生类似的问题，如：<br>$$<br>\begin{align}<br>&amp; S \rightarrow if\quad E \quad then\quad S \quad else\quad S \\<br>&amp; S \rightarrow if\quad E \quad then\quad S<br>\end{align}<br>$$<br>对文法提取左因子，取出非公共的尾部：<br>$$<br>\begin{align}<br>&amp; S \rightarrow if\quad E \quad then\quad S \quad X \\<br>&amp; S \rightarrow \\<br>&amp; S \rightarrow else \quad S<br>\end{align}<br>$$</p>
<h5 id="错误恢复"><a href="#错误恢复" class="headerlink" title="错误恢复"></a>错误恢复</h5><p>文法3-7的代码：</p>
<pre class=" language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">T</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>tok<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> ID<span class="token punctuation">:</span>
        <span class="token keyword">case</span> NUM<span class="token punctuation">:</span>
        <span class="token keyword">case</span> LPAREN<span class="token punctuation">:</span> <span class="token function">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">Tprime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">default</span><span class="token punctuation">:</span> error<span class="token operator">!</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">Tprime</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>tok<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> PLUS<span class="token punctuation">:</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> TIMES<span class="token punctuation">:</span> <span class="token function">eat</span><span class="token punctuation">(</span>TIMES<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">Tprime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> RPAREN<span class="token punctuation">:</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">default</span><span class="token punctuation">:</span> error<span class="token operator">!</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>错误处理的较好方式是：输出一条信息，然后尝试 <strong><em>恢复</em></strong> 错误，并继续后继处理，从而可以发现更多错误。</p>
<ul>
<li>插入单词<br>插入单词来进行错误恢复是一种危险的做法，可能插入会进一步导致其他错误，陷入死循环。插入法不必对实际的输入调整，假装存在某个单词，输出错误信息，然后返回即可<pre class=" language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">T</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>tok<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> ID<span class="token punctuation">:</span>
      <span class="token keyword">case</span> NUM<span class="token punctuation">:</span>
      <span class="token keyword">case</span> LPAREN<span class="token punctuation">:</span> <span class="token function">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">Tprime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"expected id,num, or left-paren"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
</li>
<li>删除单词<br>跳过若干个单词直至达到一个属于 FOLLOW 集合的单词为止.<pre class=" language-c"><code class="language-c"><span class="token keyword">int</span> TPrime_follow <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>PLUS <span class="token punctuation">,</span>RPAREN<span class="token punctuation">,</span><span class="token constant">EOF</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">Tprime</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>tok<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> PLUS<span class="token punctuation">:</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> TIMES<span class="token punctuation">:</span> <span class="token function">eat</span><span class="token punctuation">(</span>TIMES<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">Tprime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> RPAREN<span class="token punctuation">:</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token constant">EOF</span><span class="token punctuation">:</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">default</span><span class="token punctuation">:</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"expected +,*,right-paren, or end-of-file"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">skipto</span><span class="token punctuation">(</span>TPrime_follow<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
递归下降分析器的错误恢复必须具有调整机制。尝试-出错-再尝试。<h4 id="LR分析"><a href="#LR分析" class="headerlink" title="LR分析"></a>LR分析</h4>LL(k)技术在看到等式右部的前k个单词就必须预测要使用的是哪一个产生式，另一种技术LR（k）分析，LR分析使用栈，这样可以在输入整个右部以后再做判断。LR（k）代表 <strong><em>从左到右分析,最右推导，超前查看k个单词（Left-to-right parse，Rightmost-derivation，k-tocken lookhead）</em></strong>。</li>
</ul>
<p>LR（k）分析有一个 <strong><em>栈</em></strong> 和一个 <strong><em>输入</em></strong>，输入中的前k个单词为超前查看的单词。根据栈和超前查看的单词，分析器执行两种动作</p>
<ul>
<li>移进：压栈，最后移进文件爱你结束符的动作称为接收（accepting）</li>
<li>归约：选择文法，弹出文法表达式的单词，移进等式左部。</li>
</ul>
<p><img src="https://s2.ax1x.com/2019/04/08/A4oijS.png" alt="A4oijS.png"></p>
<h5 id="LR分析引擎"><a href="#LR分析引擎" class="headerlink" title="LR分析引擎"></a>LR分析引擎</h5><p>又是Kunth真神开发的。ORZ</p>
<p>LR通过作用于栈的DFA来判断应该采取的策略，DFA的边是由非终结符和终结符来标记的。<br><a href="https://imgchr.com/i/A4okng" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/04/08/A4okng.png" alt="A4okng.png"></a><br>转换表中的元素有四种动作：</p>
<ul>
<li>sn 移进到状态n</li>
<li>gn 转换到状态n</li>
<li>rk 根据规则k归约</li>
<li>a 接受</li>
<li>错误</li>
</ul>
<p>对于每一个单词，分析器不是重新扫描栈，而是记住没一个栈元素到达的状态<br><a href="https://imgchr.com/i/A4oABQ" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/04/08/A4oABQ.png" alt="A4oABQ.png"></a></p>
<h5 id="LR（0）分析器生成器"><a href="#LR（0）分析器生成器" class="headerlink" title="LR（0）分析器生成器"></a>LR（0）分析器生成器</h5><p>上表说明了当k等于1时，当k=2时，这个表的每个序列是又两个单词组成的序列，实际编译器并不使用k&gt;1的表。我们使用文法3-8来构造一个LR（0）分析器，<br>文法3-8</p>
<p>最开始的状态是1</p>
<p>其中圆点代表分析器当前的位置，，文法规则与指出其右部位置的圆点组合称为项</p>
<ul>
<li>移进动作（shift action）<br>根据文法3-8可能会出现两个状态</li>
<li>转换动作（goto action）位移圆点，当某个文法被归约时，弹出所有右部符号</li>
<li>归约 动作（reduce action）</li>
</ul>
<p>可以得到DFA<br><a href="https://imgchr.com/i/A4TF8x" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/04/08/A4TF8x.png" alt="A4TF8x.png"></a></p>
<p>然后根据DFA可以构造出分析表<br><img src="https://s2.ax1x.com/2019/04/08/A4TlGt.png" alt="A4TlGt.png"></p>
<h5 id="SLR分析器的生成"><a href="#SLR分析器的生成" class="headerlink" title="SLR分析器的生成"></a>SLR分析器的生成</h5><p>比LR(0)更好的一种技术是SLR即Simple LR的简称，SLR和LR（0）的构造方法近乎相同，但是SLR只在FOLLOW集合制定的地方放置归约动作。</p>
<p>回忆LR(0)分析表的构造过程</p>
<ul>
<li>对于任意一条边 $I \xrightarrow{X} J$<ul>
<li>若X为终结符，则在表中 $(I,X)$ 加移进J(sJ)<ul>
<li>若X为非终结符，则在表中 $(I,X)$加转换J(gJ)</li>
</ul>
</li>
</ul>
</li>
<li>对于包含项 $S’ \rightarrow S.＄$ 的每个状态I我们在位置 $(I,＄)$ 放置接收动作（a）</li>
<li>对于包含项 $A \rightarrow \gamma$ 的状态，对每一个单词Y，放置归约n（rn）于 $(I,Y)$ 中。</li>
</ul>
<p>得到LR（0）的分析表以后我们判断是否rn的这个单词属于FOLLOW(A)，如果不属于则删除。</p>
<h5 id="LR（1）项和LR（1）分析表"><a href="#LR（1）项和LR（1）分析表" class="headerlink" title="LR（1）项和LR（1）分析表"></a>LR（1）项和LR（1）分析表</h5><p>LR（1）比SLR更为强大，相对于LR(0)分析，LR(1)分析表项的概念更见复杂，由三个要素构成：</p>
<ul>
<li>一个文法产生式</li>
<li>一个右部位置（圆点表示）</li>
<li>一个超前查看的符号</li>
</ul>
<p>即项 $(A \rightarrow \alpha,\beta,x)$ 指出：序列 $\alpha$ 在栈顶，且输入中开头的死可以从 $\beta x$ 中导出的符号串。</p>
<p>例如一个不是SLR的文法3-10有这样的DFA<br><a href="https://imgchr.com/i/A4vYLt" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/04/08/A4vYLt.png" alt="A4vYLt.png"></a></p>
<p>只要产生式的结尾有圆点，那么在LR(1)分析表中，行为状态号，列为超前查看符的地方就存在一个归约动作。<br><img src="https://s2.ax1x.com/2019/04/08/A4vISJ.png" alt="A4vISJ.png"></p>
<h5 id="LALR（1）分析表"><a href="#LALR（1）分析表" class="headerlink" title="LALR（1）分析表"></a>LALR（1）分析表</h5><p>LALR(1)表即（Look-head LR(1)），观察DFA我们可以发许多状态都是重复的，为了节省空间，我们可以吧除了超前插卡符号，其他状态都相同的状态合并，这样就可以得到一个储存空间的较小的表，但是对于某些文法，LALR(1)含有归约-归约冲突，但是使劲应用中，这种影响非常小。</p>
<h5 id="各类文法的层次"><a href="#各类文法的层次" class="headerlink" title="各类文法的层次"></a>各类文法的层次</h5><p>所有的SLR型文法都是LALR(1)文法，但反之不成立。<br><a href="https://imgchr.com/i/A4x3kT" target="_blank" rel="noopener"><img src="https://s2.ax1x.com/2019/04/08/A4x3kT.png" alt="A4x3kT.png"></a></p>
<p>LALR(1)文法已经变成程序设计语言和自动语法分析器的生成器的标准。</p>
<h5 id="二义性文法的LR分析"><a href="#二义性文法的LR分析" class="headerlink" title="二义性文法的LR分析"></a>二义性文法的LR分析</h5><p>许多文法含有二义性，这里我们采取最近匹配的原则，或者引入两个非终结符来重写语法。但是最好的方法还是消除二义性。</p>
<h4 id="使用分析器的生成器"><a href="#使用分析器的生成器" class="headerlink" title="使用分析器的生成器"></a>使用分析器的生成器</h4><p>Yacc(Yet another complier-complier)的规范分为三部分：</p>
<pre><code>parse declaration //终结符，非终结符组成的表
%%
grammer rules //产生式like  exp： exp PLUS exp { semantic action}
%%
programs  //原始C代码</code></pre><h5 id="冲突"><a href="#冲突" class="headerlink" title="冲突"></a>冲突</h5><p>Yacc可以指出两种冲突并自动解决</p>
<ul>
<li>移进-归约：优先移进</li>
<li>归约-归约：优先文法中靠前的规则</li>
</ul>
<h5 id="优先级指导"><a href="#优先级指导" class="headerlink" title="优先级指导"></a>优先级指导</h5><p>之前我们解决优先级的方法是引入两个辅助符号，但是还有一种方法是先构造出二义性文法的LR(1)分析表，然后修改表中的填入的内容来设定优先级的顺序。</p>
<p>Yacc有一种指明这类移进-归约冲突的 <strong>优先级指导命令</strong> ，like：</p>
<pre><code>%nonassoc EQ NEQ
%left PLUS MINUS
%left TIMES DIV
%right EXP</code></pre><p>指出+和-是左结合的且优先级相同，*和/是左结合的且优先级相同并高于+,^是右结合的且优先级最高，=和！=是非结合的，且优先级低于+。当比较一个单词和一个规则的优先级时，规则的优先级有规则最右部的单词的优先级给出当单词和规则的优先级相同时，用%left指明的偏向于归约，而%right指明的偏向于移进。</p>
<p>我们也可以使用命令%prec来指明明确的优先级，可以解决这类问题，如一元负运算问题</p>
<pre class=" language-c"><code class="language-c"><span class="token operator">%</span><span class="token punctuation">{</span> declarations of yylex and yyerror <span class="token operator">%</span><span class="token punctuation">}</span>
<span class="token operator">%</span>token INT PLUS MINUS TIMES UMINUS
<span class="token operator">%</span>start exp
<span class="token operator">%</span>left PLUS MINUS
<span class="token operator">%</span>left TIMES
<span class="token operator">%</span>left UMINUS
<span class="token operator">%</span><span class="token operator">%</span>
exp <span class="token punctuation">:</span>INT
    <span class="token operator">|</span>exp PLUS exp
    <span class="token operator">|</span>exp MINUS exp
    <span class="token operator">|</span>exp TIMES exp
    <span class="token operator">|</span>MINUS exp <span class="token operator">%</span>prec UMINUS</code></pre>
<h5 id="语法和语义"><a href="#语法和语义" class="headerlink" title="语法和语义"></a>语法和语义</h5><p>假如一个文法中既有布尔表达式又有算数表达式，算术运算的优先级高于布尔表达式，且布尔表达式不能与算数表达式相加。可以得到文法</p>
<pre class=" language-c"><code class="language-c"><span class="token operator">%</span><span class="token punctuation">{</span> declarations of yylex and yyerror <span class="token operator">%</span><span class="token punctuation">}</span>
<span class="token operator">%</span>token ID ASSIGN PLUS MINUS AND EQUAL
<span class="token operator">%</span>start stm
<span class="token operator">%</span>left OR
<span class="token operator">%</span>left AND
<span class="token operator">%</span>left PLUS
<span class="token operator">%</span><span class="token operator">%</span>
stm <span class="token punctuation">:</span> ID ASSIGN ae
    <span class="token operator">|</span> ID ASSIGN be
be  <span class="token punctuation">:</span>
    <span class="token operator">|</span>be OR be
    <span class="token operator">|</span>be AND be
    <span class="token operator">|</span>ae EQUAL ae
    <span class="token operator">|</span>ID
ae  <span class="token punctuation">:</span> ae PLUS ae
    <span class="token operator">|</span> ID</code></pre>
<p>文法存在一个移进-归约冲突。解决办法是将问题推迟到语义分析的阶段，可以修改文法使其在文法上是合法的。</p>
<h4 id="错误恢复-1"><a href="#错误恢复-1" class="headerlink" title="错误恢复"></a>错误恢复</h4><p>我们希望编译器能够找出所有的错误，而不是在第一个错误处就停下并报错。</p>
<h5 id="用error符号恢复"><a href="#用error符号恢复" class="headerlink" title="用error符号恢复"></a>用error符号恢复</h5><p>局部错误分析</p>
<p>他哦难过调整分析栈和错误查出点的输入以允许分析能够继续进行的来实现的。 $error$ 符号控制对错误恢复的处理， $error$ 可以匹配一串出错的输入单词。</p>
<p>分析器在表达式的中间遇到错误时，应该跳到下一个分号或右括号处[aka 同步单词（synchronizing token）]。可以通过增加两个错误恢复产生式，实现这一点<br>$$<br>\begin{align}<br>&amp; exp \rightarrow (error) \\<br>&amp; eps \rightarrow error;exp<br>\end{align}<br>$$</p>
<p>$error$被看作是一个终结符，当LR分析器遇到 $error$时采取：</p>
<ul>
<li>依次弹出栈顶的符号直至达到某个状态关于 $error$的状态是移进</li>
<li>移进 $error$ 单词</li>
<li>必要时 依次跳过输入符号直至达到一个超前查看单词，这个单词在当前状态有一个非错误的动作</li>
<li>重新开始分析</li>
</ul>
<p>需要注意的是Yacc的文法规则可能带有语义动作（semantic action）。可能会导致一些难以想象的语义动作</p>
<h5 id="全局错误分析（global-error-repair）"><a href="#全局错误分析（global-error-repair）" class="headerlink" title="全局错误分析（global error repair）"></a>全局错误分析（global error repair）</h5><p>最好的办法是在输入流出错点之前插入或删除单词。我们寻找的是可以将原先程序变为正确语法的最小的插入或删除集合，即使插入和删除的位置并不是LL或LR分分析器首先报告错误的地点。</p>
<ul>
<li>Burke-Fisher错误修复</li>
</ul>
<p>顾名思义是Burke和Fisher发明的错误分析方法啊，这是一个通过管理一个K个单词的序列和两个分析栈来实现错误修复的策略。也就是说，假设K=15，若分析器在扫描到输入的第100个单词时遇到了语法错误，那将在第85到100之间的单词尝试每一种可能的修复。，通常若一次修复能够使分析器超过错误点继续前进R=4个单词，就是一次足够好的修复。分析器要回退到K个单词之后重新开始分析，所以要管理两个栈，当前栈和老栈。每当移进一个新单词，将新单词压当前栈，，将新单词压入队列尾部，并取出队列头压老栈。</p>
<p>在有N个单词的序列中存在 $K+K<em>N+K</em>N$种可能性。</p>
<ul>
<li>语义动作</li>
</ul>
<p>BF错误恢复法，在当前栈并不执行语义动作，而是推迟到老栈进行。也就是说语义执行的地点会提前K+R个单词，如果语义对词法分析的行为有影响，那就很不妙。</p>
<ul>
<li>插入单词的语义值</li>
</ul>
<p>分析器需要为每个插入的单词提供一个语义值，使得语义动作的执行就像这些单词原本就来自词法分析器，Yacc提供了一个%value指导命令，允许程序员指明插入的单词的值。</p>
<pre class=" language-c"><code class="language-c"><span class="token operator">%</span>value <span class="token function">ID</span> <span class="token punctuation">(</span><span class="token string">"bogus"</span><span class="token punctuation">)</span>
<span class="token operator">%</span>value <span class="token function">INT</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token operator">%</span>value <span class="token function">STRING</span> <span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span></code></pre>
<ul>
<li>程序员制定的替代</li>
</ul>
<p>程序员可以使用%change指导命令来给出首选尝试的建议</p>
<pre class=" language-c"><code class="language-c"><span class="token operator">%</span>change  <span class="token operator">|</span>EQ <span class="token operator">-></span> ASSIGN <span class="token operator">|</span> ASSIGN <span class="token operator">-></span> EQ
SEMICOLON ELSE <span class="token operator">-></span> ELSE
<span class="token operator">|</span> <span class="token operator">-></span> IN INT END</code></pre>
<p>插入in 0 end是非常重要的更正，成为作用域关闭器（scope closer），可以在编译器需要三个单词才能关闭作用域时，关闭作用域。</p>
<h4 id="程序设计：语法分析"><a href="#程序设计：语法分析" class="headerlink" title="程序设计：语法分析"></a>程序设计：语法分析</h4><p>在<code>chap03</code>目录下的文件分别是</p>
<pre class=" language-c"><code class="language-c">errormsg<span class="token punctuation">.</span>c   \\存放出错的数据结构，帮助产生文件名和行号的报错信息
lex<span class="token punctuation">.</span>yy<span class="token punctuation">.</span>c     \\作者提供的词法分析器的输出
parsetest<span class="token punctuation">.</span>c  \\驱动程序，运行分析器来分析输入文件
util<span class="token punctuation">.</span>c
y<span class="token punctuation">.</span>output
errormsg<span class="token punctuation">.</span>h   \\存放出错的数据结构，帮助产生文件名和行号的报错信息
makefile     \\工程创建文件
tiger<span class="token punctuation">.</span>grm    \\我们需要完善的语法框架
util<span class="token punctuation">.</span>h</code></pre>
<p>可以使用优先级指导命令，但是不要给文法附加任何语义动作。</p>
<p>这里我们先使用作者提供的lex输出，如果要修改为自己的词法分析器只要将makefile中的注释打开就行了</p>
<pre class=" language-makefile"><code class="language-makefile"><span class="token symbol">a.out</span><span class="token punctuation">:</span> parsetest.o y.tab.o lex.yy.o errormsg.o util.o
    cc -g parsetest.o y.tab.o lex.yy.o errormsg.o util.o

<span class="token symbol">parsetest.o</span><span class="token punctuation">:</span> parsetest.c errormsg.h util.h
    cc -g -c parsetest.c

<span class="token symbol">y.tab.o</span><span class="token punctuation">:</span> y.tab.c
    cc -g -c y.tab.c

<span class="token symbol">y.tab.c</span><span class="token punctuation">:</span> tiger.grm
    yacc -dv tiger.grm

<span class="token symbol">y.tab.h</span><span class="token punctuation">:</span> y.tab.c
    echo <span class="token string">"y.tab.h was created at the same time as y.tab.c"</span>

<span class="token symbol">errormsg.o</span><span class="token punctuation">:</span> errormsg.c errormsg.h util.h
    cc -g -c errormsg.c

<span class="token symbol">lex.yy.o</span><span class="token punctuation">:</span> lex.yy.c y.tab.h errormsg.h util.h
    cc -g -c lex.yy.c

<span class="token comment" spellcheck="true">#lex.yy.c: tiger.lex</span>
<span class="token comment" spellcheck="true">#    lex tiger.lex</span>

<span class="token symbol">util.o</span><span class="token punctuation">:</span> util.c util.h
    cc -g -c util.c

<span class="token symbol">clean</span><span class="token punctuation">:</span>
    rm -f a.out util.o parsetest.o lex.yy.o errormsg.o y.tab.c y.tab.h y.tab.o</code></pre>
<p>然后我们就来看一下<code>tiger.grm</code>文件</p>
<pre class=" language-c"><code class="language-c"><span class="token operator">%</span><span class="token punctuation">{</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"util.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"errormsg.h"</span></span>

<span class="token keyword">int</span> <span class="token function">yylex</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">/* function prototype */</span>

<span class="token keyword">void</span> <span class="token function">yyerror</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>s<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
 <span class="token function">EM_error</span><span class="token punctuation">(</span>EM_tokPos<span class="token punctuation">,</span> <span class="token string">"%s"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token operator">%</span><span class="token punctuation">}</span>


<span class="token operator">%</span><span class="token keyword">union</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> pos<span class="token punctuation">;</span>
    <span class="token keyword">int</span> ival<span class="token punctuation">;</span>
    string sval<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token operator">%</span>token <span class="token operator">&lt;</span>sval<span class="token operator">></span> ID STRING
<span class="token operator">%</span>token <span class="token operator">&lt;</span>ival<span class="token operator">></span> INT

<span class="token operator">%</span>token
  COMMA COLON SEMICOLON LPAREN RPAREN LBRACK RBRACK
  LBRACE RBRACE DOT
  PLUS MINUS TIMES DIVIDE EQ NEQ LT LE GT GE
  AND OR ASSIGN
  ARRAY IF THEN ELSE WHILE FOR TO DO LET IN END OF
  BREAK NIL
  FUNCTION VAR TYPE

<span class="token operator">%</span>start program

<span class="token operator">%</span><span class="token operator">%</span>

program<span class="token punctuation">:</span>    exp

exp<span class="token punctuation">:</span>   ID
</code></pre>
<p>文件的前半部分已经完善，我们需要书写的是后面的grammer rules和programs部分。</p>
<p>要书写语法分析器，首先我们要把Tiger语言转化为一般的文法形式。Tiger语言的文法显然要比我们之前讨论的文法形式更多也更复杂，所以 我们使用更明显的的名称来书写等式左部。</p>
<p>首先考虑一下，在附录中我们可以知道，Tiger语言共有 种语句，26种表达式，分别是</p>
<p>$$<br>\begin{align}<br>&amp; program \rightarrow exp \\<br>&amp;  \\<br>&amp; exp \rightarrow INT \\<br>&amp; exp \rightarrow STRING \\<br>&amp; exp \rightarrow LValue \\<br>&amp; exp \rightarrow NIL \\<br>&amp; exp \rightarrow exp \quad exps \\<br>&amp; exp \rightarrow - INT \\<br>&amp; exp \rightarrow - ID \\<br>&amp; exp \rightarrow ( exp ) \\<br>&amp; exp \rightarrow () \\<br>&amp; exp \rightarrow Functioncall \\<br>&amp; exp \rightarrow Arithmetic \\<br>&amp; exp \rightarrow Comparison \\<br>&amp; exp \rightarrow exp \quad AND \quad exp \\<br>&amp; exp \rightarrow exp \quad OR \quad exp \\<br>&amp; exp \rightarrow RecordCreation \\<br>&amp; exp \rightarrow ArrayCreation \\<br>&amp; exp \rightarrow LValue := exp \\<br>&amp; exp \rightarrow IF \quad exp \quad THEN \quad exp \quad ELSE \quad exp \\<br>&amp; exp \rightarrow IF \quad exp \quad THEN \quad exp \\<br>&amp; exp \rightarrow WHILE \quad exp \quad DO \quad exp \\<br>&amp; exp \rightarrow FOR \quad ID \quad ASSIGN \quad exp \quad TO \quad exp \quad DO \quad exp \\<br>&amp; exp \rightarrow BREAK \\<br>&amp; exp \rightarrow LET \quad DeclarationSequence \quad IN \quad exp \quad END \\<br>&amp;  \\<br>&amp; exps \rightarrow ;exp \\<br>&amp; exps \rightarrow exps;exp \\<br>&amp;  \\<br>&amp; DeclarationSequence \rightarrow \varepsilon \\<br>&amp; DeclarationSequence \rightarrow Declaration \\<br>&amp;  \\<br>&amp; Declaration \rightarrow TypeDelarations \\<br>&amp; Declaration \rightarrow VarDeclaration \\<br>&amp; Declaration \rightarrow FunctionDeclatations \\<br>&amp;  \\<br>&amp; TypeDelarations \rightarrow TypeDelaration \\<br>&amp; TypeDelarations \rightarrow TypeDelarations \quad TypeDelaration \\<br>&amp;  \\<br>&amp; FunctionDeclatations \rightarrow FunctionDeclatation \\<br>&amp; FunctionDeclatations \rightarrow FunctionDeclatations \quad FunctionDeclatation \\<br>&amp;  \\<br>&amp; TypeDelaration \rightarrow Type \quad ID = OtherType \\<br>&amp;  \\<br>&amp; OtherType \rightarrow ID \\<br>&amp; OtherType \rightarrow {TypeFields} \\<br>&amp; OtherType \rightarrow ARRAY \quad OF \quad ID \\<br>&amp;  \\<br>&amp; TypeFields \rightarrow \varepsilon \\<br>&amp; TypeFields \rightarrow TypeKV \quad TypeKVList \\<br>&amp;  \\<br>&amp; TypeKV \rightarrow ID:ID \\<br>&amp;  \\<br>&amp; TypeKVList \rightarrow \varepsilon \\<br>&amp; TypeKVLsit \rightarrow TypeKVList\quad ,TypeKV \\<br>&amp;  \\<br>&amp; VarDeclaration \rightarrow Var \quad ID := exp \\<br>&amp; VarDeclaration \rightarrow Var \quad ID ,ID :=exp \\<br>&amp; FunctionDeclatation \rightarrow FUNCTION \quad ID (TypeFields) =exp \\<br>&amp; FunctionDeclatation \rightarrow FUNCTION \quad ID (TypeFields):ID =exp \\<br>&amp;  \\<br>&amp; LValue \rightarrow ID \quad LValue_extension \\<br>&amp;  \\<br>&amp; LValue_extension \rightarrow \varepsilon \\<br>&amp; LValue_extension \rightarrow .ID \quad LValue_extension \\<br>&amp; LValue_extension \rightarrow [exp]LValue_extension \\<br>&amp;  \\<br>&amp; Functioncall \rightarrow ID() \\<br>&amp; Functioncall \rightarrow ID(expList) \\<br>&amp;  \\<br>&amp; expList \rightarrow exp \\<br>&amp; expList \rightarrow expList,exp \\<br>&amp;  \\<br>&amp; Arithmetic \rightarrow exp + exp \\<br>&amp; Arithmetic \rightarrow exp - exp \\<br>&amp; Arithmetic \rightarrow exp \times exp \\<br>&amp; Arithmetic \rightarrow exp / exp \\<br>&amp;  \\<br>&amp; Comparison \rightarrow exp = exp \\<br>&amp; Comparison \rightarrow exp \neq  exp \\<br>&amp; Comparison \rightarrow exp \leq exp \\<br>&amp; Comparison \rightarrow exp \geq exp \\<br>&amp; Comparison \rightarrow exp &lt; exp \\<br>&amp; Comparison \rightarrow exp &gt; exp \\<br>&amp;  \\<br>&amp; RecordCreation \rightarrow ID{} \\<br>&amp; RecordCreation \rightarrow ID{FieldAssignmentList} \\<br>&amp;  \\<br>&amp; FieldAssignmentList \rightarrow FieldAssignment \\<br>&amp; FieldAssignmentList \rightarrow FieldAssignmentList,FieldAssignment \\<br>&amp;  \\<br>&amp; FieldAssignment \rightarrow ID = exp \\<br>&amp;  \\<br>&amp; ArrayCreation \rightarrow ID [exp] OF \quad exp \\<br>\end{align}<br>$$</p>
<p>得到了Tiger语言的文法以后我们就可以根据Yacc的规范来书写<code>tiger.grm</code>文件了。</p>
<p>我使用的是<code>Ubuntu 18.04</code>系统安装的是Yacc的一个较新的实现Bison</p>
<pre class=" language-bash"><code class="language-bash">$ yacc --version
bison <span class="token punctuation">(</span>GNU Bison<span class="token punctuation">)</span> 3.0.4
Written by Robert Corbett and Richard Stallman.

Copyright <span class="token punctuation">(</span>C<span class="token punctuation">)</span> 2015 Free Software Foundation, Inc.
This is <span class="token function">free</span> software<span class="token punctuation">;</span> see the <span class="token function">source</span> <span class="token keyword">for</span> copying conditions.  There is NO
warranty<span class="token punctuation">;</span> not even <span class="token keyword">for</span> MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</code></pre>
<p>这里简单介绍一下Bison的基本使用，在<a href="http://www.gnu.org/software/bison/" target="_blank" rel="noopener">Bison官网</a>我们可以了解到Bison的语法和使用规则。</p>
<p>最终的<code>tiger.grm</code>文件如下：</p>
<pre class=" language-c"><code class="language-c"><span class="token operator">%</span><span class="token punctuation">{</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"util.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"symbol.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"errormsg.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"absyn.h"</span></span>
<span class="token keyword">int</span> <span class="token function">yylex</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">/* function prototype */</span>
A_exp absyn_root<span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">yyerror</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>s<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token function">EM_error</span><span class="token punctuation">(</span>EM_tokPos<span class="token punctuation">,</span> <span class="token string">"%s"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">%</span><span class="token punctuation">}</span>

<span class="token operator">%</span><span class="token keyword">union</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> pos<span class="token punctuation">;</span>
    <span class="token keyword">int</span> ival<span class="token punctuation">;</span>
    string sval<span class="token punctuation">;</span>
    A_var var<span class="token punctuation">;</span>
    A_exp exp<span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">/* et cetera */</span>
    A_expList    expList<span class="token punctuation">;</span>
    A_decList    decList<span class="token punctuation">;</span>
    A_dec dec<span class="token punctuation">;</span>
    A_ty ty<span class="token punctuation">;</span>
    A_namety namety<span class="token punctuation">;</span>
    A_nametyList nametyList<span class="token punctuation">;</span>
    A_fundec funcdec<span class="token punctuation">;</span>
    A_fundecList funcdecList<span class="token punctuation">;</span>
    A_field    field<span class="token punctuation">;</span>
    A_fieldList fieldList<span class="token punctuation">;</span>
    A_efield efield<span class="token punctuation">;</span>
    A_efieldList efieldList<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">%</span>token <span class="token operator">&lt;</span>sval<span class="token operator">></span> ID STRING
<span class="token operator">%</span>token <span class="token operator">&lt;</span>ival<span class="token operator">></span> INT
<span class="token operator">%</span>token
COMMA COLON SEMICOLON LPAREN RPAREN LBRACK RBRACK
LBRACE RBRACE DOT
PLUS MINUS TIMES DIVIDE EQ NEQ LT LE GT GE
AND OR ASSIGN
ARRAY IF THEN ELSE WHILE FOR TO DO LET IN END OF
BREAK NIL
FUNCTION VAR TYPE
<span class="token operator">%</span>nonassoc LOWER
<span class="token operator">%</span>nonassoc OF
<span class="token operator">%</span>nonassoc IF THEN WHILE DO FOR TO
<span class="token operator">%</span>left ELSE
<span class="token operator">%</span>nonassoc ASSIGN
<span class="token operator">%</span>left OR AND
<span class="token operator">%</span>nonassoc EQ NEQ GT LT GE LE
<span class="token operator">%</span>left PLUS MINUS
<span class="token operator">%</span>left TIMES DIVIDE
<span class="token operator">%</span>nonassoc TYPE
<span class="token operator">%</span>nonassoc FUNCTION

<span class="token operator">%</span>start program
<span class="token operator">%</span><span class="token operator">%</span>
program
    <span class="token punctuation">:</span> exp   <span class="token punctuation">{</span><span class="token punctuation">}</span>

exp <span class="token punctuation">:</span> varExp <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token operator">|</span> nilExp <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token operator">|</span> intExp <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token operator">|</span> stringExp <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token operator">|</span> callExp <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token operator">|</span> opExp <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token operator">|</span> recordExp <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token operator">|</span> seqExp <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token operator">|</span> assignExp <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token operator">|</span> ifExp <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token operator">|</span> whileExp <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token operator">|</span> forExp <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token operator">|</span> breakExp <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token operator">|</span> letExp <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token operator">|</span> arrayExp <span class="token punctuation">{</span><span class="token punctuation">}</span>

varExp
    <span class="token punctuation">:</span> lvalue <span class="token punctuation">{</span><span class="token punctuation">}</span>

nilExp
    <span class="token punctuation">:</span> NIL <span class="token punctuation">{</span><span class="token punctuation">}</span>

intExp
    <span class="token punctuation">:</span> INT <span class="token punctuation">{</span><span class="token punctuation">}</span>

stringExp
    <span class="token punctuation">:</span> STRING <span class="token punctuation">{</span><span class="token punctuation">}</span>

callExp
    <span class="token punctuation">:</span> ID LPAREN argList RPAREN  <span class="token punctuation">{</span><span class="token punctuation">}</span>

opExp
    <span class="token punctuation">:</span> exp PLUS exp <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token operator">|</span> exp MINUS exp <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token operator">|</span> exp TIMES exp <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token operator">|</span> exp DIVIDE exp <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token operator">|</span> exp EQ exp <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token operator">|</span> exp NEQ exp <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token operator">|</span> exp LT exp <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token operator">|</span> exp LE exp <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token operator">|</span> exp GT exp <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token operator">|</span> exp GE exp <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token operator">|</span> MINUS exp <span class="token punctuation">{</span><span class="token punctuation">}</span>

recordExp
    <span class="token punctuation">:</span> ID LBRACE efieldList RBRACE <span class="token punctuation">{</span><span class="token punctuation">}</span>

seqExp
    <span class="token punctuation">:</span> LPAREN seqList RPAREN <span class="token punctuation">{</span><span class="token punctuation">}</span>

assignExp
    <span class="token punctuation">:</span> lvalue ASSIGN exp <span class="token punctuation">{</span><span class="token punctuation">}</span>

ifExp
    <span class="token punctuation">:</span> IF exp THEN exp ELSE exp <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token operator">|</span> IF exp THEN exp <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token operator">|</span> exp OR exp <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token operator">|</span> exp AND exp <span class="token punctuation">{</span><span class="token punctuation">}</span>

whileExp
    <span class="token punctuation">:</span> WHILE exp DO exp <span class="token punctuation">{</span><span class="token punctuation">}</span>

forExp
    <span class="token punctuation">:</span> FOR ID ASSIGN exp TO exp DO exp <span class="token punctuation">{</span><span class="token punctuation">}</span>

breakExp
    <span class="token punctuation">:</span> BREAK <span class="token punctuation">{</span><span class="token punctuation">}</span>

letExp
    <span class="token punctuation">:</span> LET decList IN seqList END <span class="token punctuation">{</span><span class="token punctuation">}</span>

arrayExp
    <span class="token punctuation">:</span> ID LBRACK exp RBRACK OF exp <span class="token punctuation">{</span><span class="token punctuation">}</span>

lvalue
    <span class="token punctuation">:</span> ID  <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token operator">|</span> lvalue DOT ID <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token operator">|</span> lvalue LBRACK exp RBRACK <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token operator">|</span> ID LBRACK exp RBRACK <span class="token punctuation">{</span><span class="token punctuation">}</span>

argList
    <span class="token punctuation">:</span> <span class="token operator">%</span>empty <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token operator">|</span> exp argList_ <span class="token punctuation">{</span><span class="token punctuation">}</span>

argList_
    <span class="token punctuation">:</span> <span class="token operator">%</span>empty <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token operator">|</span> COMMA exp argList_ <span class="token punctuation">{</span><span class="token punctuation">}</span>

efield
    <span class="token punctuation">:</span> ID EQ exp <span class="token punctuation">{</span><span class="token punctuation">}</span>

efieldList
    <span class="token punctuation">:</span> <span class="token operator">%</span>empty <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token operator">|</span> efield efieldList_ <span class="token punctuation">{</span><span class="token punctuation">}</span>

efieldList_
    <span class="token punctuation">:</span> <span class="token operator">%</span>empty <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token operator">|</span> COMMA efield efieldList_ <span class="token punctuation">{</span><span class="token punctuation">}</span>

seqList
    <span class="token punctuation">:</span> <span class="token operator">%</span>empty <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token operator">|</span> exp <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token operator">|</span> exp SEMICOLON seqList <span class="token punctuation">{</span><span class="token punctuation">}</span>

decList
    <span class="token punctuation">:</span> dec <span class="token operator">%</span>prec LOWER <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token operator">|</span> dec decList <span class="token punctuation">{</span><span class="token punctuation">}</span>

dec <span class="token punctuation">:</span> typeDec <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token operator">|</span> varDec <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token operator">|</span> funcDec <span class="token punctuation">{</span><span class="token punctuation">}</span>

typeDec
    <span class="token punctuation">:</span> nametyList <span class="token punctuation">{</span><span class="token punctuation">}</span>

varDec
    <span class="token punctuation">:</span> VAR ID ASSIGN exp <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token operator">|</span> VAR ID COLON ID ASSIGN exp <span class="token punctuation">{</span><span class="token punctuation">}</span>

funcDec
    <span class="token punctuation">:</span> funcDecList <span class="token punctuation">{</span><span class="token punctuation">}</span>

funcDecList
    <span class="token punctuation">:</span> funcDec_ <span class="token operator">%</span>prec LOWER <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token operator">|</span>   funcDec_ funcDecList <span class="token punctuation">{</span><span class="token punctuation">}</span>

funcDec_
    <span class="token punctuation">:</span> FUNCTION ID LPAREN fieldList RPAREN COLON ID EQ exp <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token operator">|</span> FUNCTION ID LPAREN fieldList RPAREN EQ exp <span class="token punctuation">{</span><span class="token punctuation">}</span>

nametyList
    <span class="token punctuation">:</span> namety <span class="token operator">%</span>prec LOWER <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token operator">|</span> namety nametyList <span class="token punctuation">{</span><span class="token punctuation">}</span>

namety
    <span class="token punctuation">:</span> TYPE ID EQ ID <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token operator">|</span> TYPE ID EQ LBRACE fieldList RBRACE <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token operator">|</span> TYPE ID EQ ARRAY OF ID <span class="token punctuation">{</span><span class="token punctuation">}</span>

field
    <span class="token punctuation">:</span> ID COLON ID <span class="token punctuation">{</span><span class="token punctuation">}</span>

fieldList
    <span class="token punctuation">:</span> <span class="token operator">%</span>empty <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token operator">|</span> field fieldList_ <span class="token punctuation">{</span><span class="token punctuation">}</span>

fieldList_
    <span class="token punctuation">:</span> <span class="token operator">%</span>empty <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token operator">|</span> COMMA field fieldList_ <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre>
<p>每个文法生成式之后的括号是为了后面第四章要使用到的语义分析，这里暂且先留空，第一次make的时候出现了这个问题（开玩笑的，其实make好几遍了）：</p>
<pre class=" language-bash"><code class="language-bash">$ <span class="token function">make</span>
cc  -g -c parsetest.c
parsetest.c: In <span class="token keyword">function</span> main:
parsetest.c:16:59: warning: implicit declaration of <span class="token keyword">function</span> <span class="token keyword">exit</span> <span class="token punctuation">[</span>-Wimplicit-function-declaration<span class="token punctuation">]</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>argc<span class="token operator">!=</span>2<span class="token punctuation">)</span> <span class="token punctuation">{</span>fprintf<span class="token punctuation">(</span>stderr,usage: a.out filename\n<span class="token punctuation">)</span><span class="token punctuation">;</span> exit<span class="token punctuation">(</span>1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
                                                           ^~~~
parsetest.c:16:59: warning: incompatible implicit declaration of built-in <span class="token keyword">function</span> <span class="token keyword">exit</span>
parsetest.c:16:59: note: include ‘<span class="token operator">&lt;</span>stdlib.h<span class="token operator">></span>’ or provide a declaration of ‘exit’
yacc -dv tiger.grm
tiger.grm: warning: 3 shift/reduce conflicts <span class="token punctuation">[</span>-Wconflicts-sr<span class="token punctuation">]</span>
cc -g -c y.tab.c
cc -g -c lex.yy.c
In <span class="token function">file</span> included from lex.yy.c:1:0:
lex.yy.c:20:15: error: initializer element is not constant
 FILE *yyin <span class="token operator">=</span> <span class="token punctuation">{</span>stdin<span class="token punctuation">}</span>, *yyout <span class="token operator">=</span> <span class="token punctuation">{</span>stdout<span class="token punctuation">}</span><span class="token punctuation">;</span>
               ^
lex.yy.c:20:15: note: <span class="token punctuation">(</span>near initialization <span class="token keyword">for</span> ‘yyin’<span class="token punctuation">)</span>
lex.yy.c:20:33: error: initializer element is not constant
 FILE *yyin <span class="token operator">=</span> <span class="token punctuation">{</span>stdin<span class="token punctuation">}</span>, *yyout <span class="token operator">=</span> <span class="token punctuation">{</span>stdout<span class="token punctuation">}</span><span class="token punctuation">;</span>
                                 ^
lex.yy.c:20:33: note: <span class="token punctuation">(</span>near initialization <span class="token keyword">for</span> ‘yyout’<span class="token punctuation">)</span>
lex.yy.c:31:10: fatal error: symbol.h: No such <span class="token function">file</span> or directory
 <span class="token comment" spellcheck="true">#include "symbol.h"</span>
          ^~~~~~~~~~
compilation terminated.
makefile:20: recipe <span class="token keyword">for</span> target lex.yy.o failed
make: *** <span class="token punctuation">[</span>lex.yy.o<span class="token punctuation">]</span> Error 1</code></pre>
<p>作者好像没在<code>/chap3</code>这个目录下给出<code>symbol.h</code>文件，不过这些文件存放在<code>/chap4</code>目录下，在<code>/chap4</code>下执行</p>
<pre class=" language-bash"><code class="language-bash">$ <span class="token function">cp</span> symbol.c symbol.h absyn.h absyn.c <span class="token punctuation">..</span>/chap3
$ <span class="token function">make</span> clean
$ <span class="token function">make</span></code></pre>
<p>然后就可以获得<code>y.output</code>:</p>
<pre class=" language-c"><code class="language-c">State <span class="token number">1</span> conflicts<span class="token punctuation">:</span> <span class="token number">1</span> shift<span class="token operator">/</span>reduce
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
State <span class="token number">1</span>

   <span class="token number">21</span> callExp<span class="token punctuation">:</span> ID <span class="token punctuation">.</span> LPAREN argList RPAREN
   <span class="token number">33</span> recordExp<span class="token punctuation">:</span> ID <span class="token punctuation">.</span> LBRACE efieldList RBRACE
   <span class="token number">44</span> arrayExp<span class="token punctuation">:</span> ID <span class="token punctuation">.</span> LBRACK exp RBRACK OF exp
   <span class="token number">45</span> lvalue<span class="token punctuation">:</span> ID <span class="token punctuation">.</span>
   <span class="token number">48</span>       <span class="token operator">|</span> ID <span class="token punctuation">.</span> LBRACK exp RBRACK

    LPAREN  shift<span class="token punctuation">,</span> and go to state <span class="token number">30</span>
    LBRACK  shift<span class="token punctuation">,</span> and go to state <span class="token number">31</span>
    LBRACE  shift<span class="token punctuation">,</span> and go to state <span class="token number">32</span>

    LBRACK    <span class="token punctuation">[</span>reduce using rule <span class="token function">45</span> <span class="token punctuation">(</span>lvalue<span class="token punctuation">)</span><span class="token punctuation">]</span>
    $<span class="token keyword">default</span>  reduce using rule <span class="token function">45</span> <span class="token punctuation">(</span>lvalue<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></code></pre>
<p>这里我们有很多方法可以解决这种移进/规约冲突的问题。</p>
<p>在介绍方法之前，我们先来分析一下这个问题，这个语法分析器在ID这里exp遇到了两种可能性：</p>
<ul>
<li><strong><em>shift移进.</em></strong><br>exp在这里可以被移进为<code>ID [exp] OF exp</code><pre class=" language-c"><code class="language-c">ID <span class="token string">'['</span> exp <span class="token string">']'</span> OF exp        <span class="token operator">--</span><span class="token operator">></span> <span class="token function">exp</span>    <span class="token punctuation">(</span>rule <span class="token number">25</span><span class="token punctuation">)</span></code></pre>
</li>
<li><strong><em>reduce规约.</em></strong><br>exp在这里是<code>ID[exp]</code>,<pre class=" language-c"><code class="language-c">ID                           <span class="token operator">--</span><span class="token operator">></span> <span class="token function">lvalue</span> <span class="token punctuation">(</span>rule <span class="token number">34</span><span class="token punctuation">)</span>
lvalue <span class="token string">'['</span> exp <span class="token string">']'</span>           <span class="token operator">--</span><span class="token operator">></span> <span class="token function">lvalue</span> <span class="token punctuation">(</span>rule <span class="token number">36</span><span class="token punctuation">)</span>
lvalue                       <span class="token operator">--</span><span class="token operator">></span> <span class="token function">exp</span>    <span class="token punctuation">(</span>rule <span class="token number">2</span><span class="token punctuation">)</span></code></pre>
问题是语法分析器无法在看到OF单词之前，明确的作出判断该使用哪一个生成式。</li>
</ul>
<p>这里的解决方案是避免语法分析器在此时作出判断：</p>
<ul>
<li><p>1.因为表达式只能是<code>ID [ exp ] OF</code>，所以我们可以从冲突中提出公因子ID：</p>
<pre class=" language-bash"><code class="language-bash">exp   <span class="token keyword">:</span> ID
      <span class="token operator">|</span> lvalue_not_id
      <span class="token operator">|</span> <span class="token punctuation">..</span>.

lvalue: ID
      <span class="token operator">|</span> lvalue_not_id

lvalue_not_ID
      <span class="token keyword">:</span> lvalue DOT ID
      <span class="token operator">|</span> ID            LBRACK exp RBRACK
      <span class="token operator">|</span> lvalue_not_ID LBRACK exp RBRACK</code></pre>
</li>
</ul>
<ul>
<li><p>2.看到文法中存在一个移进/规约冲突在State1,这是因为我们使用Apple在书中提到的使用一个冗余的表达式来解决移进/规约冲突，但是这个表达式依然会引发一个移进规约冲突，实际上，它是一个与原始语法完全相同的shift-reduce冲突。但是这一次，冲突是在两个不同的制作之间进行的lvalue，默认的移进动作是我们想要的ID接受<code>[</code>。在转换之后，lvalue生产和exp仍然可用，因此解析器在<code>]</code>之前不必作出决定。这里的移进规约冲突实际上不会影响我们的语法的判断。</p>
</li>
<li><p>3.另一个解决方案就是使用bison的<code>%glr-parser</code>指令来生成GLR解析器。GLR算法能够通过有效地同时维护两个（或更多个）不同的可能解析器堆栈来延迟减少决策。对于明确的语法，在输入的长度上仍然是O（n），但它稍慢。（此外，此选项在许多其他yacc衍生产品中不可用。）</p>
</li>
</ul>
<p>可以看到如果我们自己手写DFA那将是一项非常复杂的工作。然后套用我们自己的词法分析器看看是否成功，修改makefile的文件，将注释符号<code>#</code>去掉，将第二章完成的词法分析器复制到目录下：</p>
<pre class=" language-bash"><code class="language-bash">~/chap2 $ <span class="token function">cp</span> tiger.lex token.h <span class="token punctuation">..</span>/chap03
~/chap3 $ <span class="token function">make</span> clean
~/chap3 $ <span class="token function">make</span></code></pre>
<p>结果也是顺利生成了语法分析器。这里有个比较有意思的Bison选项是<code>--graph</code>，这个选项可以根据你的DFA生成图像，比较适合初学者理解</p>
<pre class=" language-bash"><code class="language-bash">$ <span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> graphviz
$ bison --graph tiger.grm
$ dot tiger.dot -Tsvg -o tiger.svg</code></pre>
<p>ps：这个过程常常由于内存不够而崩溃。我这里已经跑了30mins了还没有完成做图</p>
<h5 id="添加error表达式"><a href="#添加error表达式" class="headerlink" title="添加error表达式"></a>添加error表达式</h5><p>下面要求添加一个error表达式，并且举例证明可以完成错误修复。由于我们没有使用语义动作，所以我们可以不用考虑语义动作对错误恢复带来的影响。</p>
<p>错误恢复有两种方式，一种是局部恢复技术，第二种是全局恢复技术。全局恢复技术主要针对的是语义动作的影响，而且全局回复技术并不需要error产生式的辅助，所以这里我们使用局部错误恢复的方法来重新设计文法。这一节的内容可以在<a href="https://www.gnu.org/software/bison/manual/bison.html#Error-Recovery" target="_blank" rel="noopener">Bison文档第6节Error Recovery</a></p>
<p>修改文法的第一步是找到同步单词synchronizing token，然后再继续分析。<br>修改后的文法如下：</p>
<p>$$<br>\begin{align}<br>&amp; program \rightarrow exp \\<br>&amp;  \\<br>&amp; exp \rightarrow INT \\<br>&amp; exp \rightarrow STRING \\<br>&amp; exp \rightarrow LValue \\<br>&amp; exp \rightarrow NIL \\<br>&amp; exp \rightarrow exp \quad exps \\<br>&amp; exp \rightarrow - INT \\<br>&amp; exp \rightarrow - ID \\<br>&amp; exp \rightarrow ( exp ) \\<br>&amp; exp \rightarrow () \\<br>&amp; exp \rightarrow Functioncall \\<br>&amp; exp \rightarrow Arithmetic \\<br>&amp; exp \rightarrow Comparison \\<br>&amp; exp \rightarrow exp \quad AND \quad exp \\<br>&amp; exp \rightarrow exp \quad OR \quad exp \\<br>&amp; exp \rightarrow RecordCreation \\<br>&amp; exp \rightarrow ArrayCreation \\<br>&amp; exp \rightarrow LValue := exp \\<br>&amp; exp \rightarrow IF \quad exp \quad THEN \quad exp \quad ELSE \quad exp<br>&amp; exp \rightarrow error<br>\\<br>&amp; exp \rightarrow IF \quad exp \quad THEN \quad exp \\<br>&amp; exp \rightarrow WHILE \quad exp \quad DO \quad exp \\<br>&amp; exp \rightarrow FOR \quad ID \quad ASSIGN \quad exp \quad TO \quad exp \quad DO \quad exp \\<br>&amp; exp \rightarrow BREAK \\<br>&amp; exp \rightarrow LET \quad DeclarationSequence \quad IN \quad exp \quad END \\<br>&amp;  \\<br>&amp; exps \rightarrow ;exp \\<br>&amp; exps \rightarrow exps;exp \\<br>&amp;  \\<br>&amp; DeclarationSequence \rightarrow \varepsilon \\<br>&amp; DeclarationSequence \rightarrow Declaration \\<br>&amp;  \\<br>&amp; Declaration \rightarrow TypeDelarations \\<br>&amp; Declaration \rightarrow VarDeclaration \\<br>&amp; Declaration \rightarrow FunctionDeclatations \\<br>&amp;  \\<br>&amp; TypeDelarations \rightarrow TypeDelaration \\<br>&amp; TypeDelarations \rightarrow TypeDelarations \quad TypeDelaration \\<br>&amp;  \\<br>&amp; FunctionDeclatations \rightarrow FunctionDeclatation \\<br>&amp; FunctionDeclatations \rightarrow FunctionDeclatations \quad FunctionDeclatation \\<br>&amp;  \\<br>&amp; TypeDelaration \rightarrow Type \quad ID = OtherType \\<br>&amp;  \\<br>&amp; OtherType \rightarrow ID \\<br>&amp; OtherType \rightarrow {TypeFields} \\<br>&amp; OtherType \rightarrow ARRAY \quad OF \quad ID \\<br>&amp;  \\<br>&amp; TypeFields \rightarrow \varepsilon \\<br>&amp; TypeFields \rightarrow TypeKV \quad TypeKVList \\<br>&amp;  \\<br>&amp; TypeKV \rightarrow ID:ID \\<br>&amp;  \\<br>&amp; TypeKVList \rightarrow \varepsilon \\<br>&amp; TypeKVLsit \rightarrow TypeKVList\quad ,TypeKV \\<br>&amp;  \\<br>&amp; VarDeclaration \rightarrow Var \quad ID := exp \\<br>&amp; VarDeclaration \rightarrow Var \quad ID ,ID :=exp \\<br>&amp; FunctionDeclatation \rightarrow FUNCTION \quad ID (TypeFields) =exp \\<br>&amp; FunctionDeclatation \rightarrow FUNCTION \quad ID (TypeFields):ID =exp \\<br>&amp;  \\<br>&amp; LValue \rightarrow ID \quad LValue_extension \\<br>&amp;  \\<br>&amp; LValue_extension \rightarrow \varepsilon \\<br>&amp; LValue_extension \rightarrow .ID \quad LValue_extension \\<br>&amp; LValue_extension \rightarrow [exp]LValue_extension \\<br>&amp;  \\<br>&amp; Functioncall \rightarrow ID() \\<br>&amp; Functioncall \rightarrow ID(expList) \\<br>&amp;  \\<br>&amp; expList \rightarrow exp \\<br>&amp; expList \rightarrow expList,exp \\<br>&amp;  \\<br>&amp; Arithmetic \rightarrow exp + exp \\<br>&amp; Arithmetic \rightarrow exp - exp \\<br>&amp; Arithmetic \rightarrow exp \times exp \\<br>&amp; Arithmetic \rightarrow exp / exp \\<br>&amp;  \\<br>&amp; Comparison \rightarrow exp = exp \\<br>&amp; Comparison \rightarrow exp \neq  exp \\<br>&amp; Comparison \rightarrow exp \leq exp \\<br>&amp; Comparison \rightarrow exp \geq exp \\<br>&amp; Comparison \rightarrow exp &lt; exp \\<br>&amp; Comparison \rightarrow e&amp; program \rightarrow exp \\<br>&amp;  \\<br>&amp; exp \rightarrow INT \\<br>&amp; exp \rightarrow STRING \\<br>&amp; exp \rightarrow LValue \\<br>&amp; exp \rightarrow NIL \\<br>&amp; exp \rightarrow exp \quad exps \\<br>&amp; exp \rightarrow - INT \\<br>&amp; exp \rightarrow - ID \\<br>&amp; exp \rightarrow ( exp ) \\<br>&amp; exp \rightarrow () \\<br>&amp; exp \rightarrow Functioncall \\<br>&amp; exp \rightarrow Arithmetic \\<br>&amp; exp \rightarrow Comparison \\<br>&amp; exp \rightarrow exp AND exp \\<br>&amp; exp \rightarrow exp OR exp \\<br>&amp; exp \rightarrow RecordCreation \\<br>&amp; exp \rightarrow ArrayCreation \\<br>&amp; exp \rightarrow LValue := exp \\<br>&amp; exp \rightarrow IF exp THEN exp ELSE exp \\<br>&amp; exp \rightarrow IF exp THEN exp \\<br>&amp; exp \rightarrow WHILE exp DO exp \\<br>&amp; exp \rightarrow FOR ID ASSIGN exp TO exp DO exp \\<br>&amp; exp \rightarrow BREAK \\<br>&amp; exp \rightarrow LET DeclarationSequence IN exp END \\<br>&amp;  \\<br>&amp; exps \rightarrow ;exp \\<br>&amp; exps \rightarrow exps;exp \\<br>&amp;  \\<br>&amp; DeclarationSequence \rightarrow \varepsilon \\<br>&amp; DeclarationSequence \rightarrow Declaration \\<br>&amp;  \\<br>&amp; Declaration \rightarrow TypeDelarations \\<br>&amp; Declaration \rightarrow VarDeclaration \\<br>&amp; Declaration \rightarrow FunctionDeclatations \\<br>&amp;  \\<br>&amp; TypeDelarations \rightarrow TypeDelaration \\<br>&amp; TypeDelarations \rightarrow TypeDelarations TypeDelaration \\<br>&amp;  \\<br>&amp; FunctionDeclatations \rightarrow FunctionDeclatation \\<br>&amp; FunctionDeclatations \rightarrow FunctionDeclatations FunctionDeclatation \\<br>&amp;  \\<br>&amp; TypeDelaration \rightarrow Type ID = OtherType \\<br>&amp;  \\<br>&amp; OtherType \rightarrow ID \\<br>&amp; OtherType \rightarrow {TypeFields} \\<br>&amp; OtherType \rightarrow ARRAY OF ID \\<br>&amp;  \\<br>&amp; TypeFields \rightarrow \varepsilon \\<br>&amp; TypeFields \rightarrow TypeKV TypeKVList \\<br>&amp;  \\<br>&amp; TypeKV \rightarrow ID:ID \\<br>&amp;  \\<br>&amp; TypeKVList \rightarrow \varepsilon \\<br>&amp; TypeKVLsit \rightarrow TypeKVList,TypeKV \\<br>&amp;  \\<br>&amp; VarDeclaration \rightarrow Var ID := exp \\<br>&amp; VarDeclaration \rightarrow Var ID ,ID :=exp \\<br>&amp; FunctionDeclatation \rightarrow FUNCTION ID (TypeFields) =exp \\<br>&amp; FunctionDeclatation \rightarrow FUNCTION ID (TypeFields):ID =exp \\<br>&amp;  \\<br>&amp; LValue \rightarrow ID LValue_extension \\<br>&amp;  \\<br>&amp; LValue_extension \rightarrow \varepsilon \\<br>&amp; LValue_extension \rightarrow .ID LValue_extension \\<br>&amp; LValue_extension \rightarrow [exp]LValue_extension \\<br>&amp;  \\<br>&amp; Functioncall \rightarrow ID() \\<br>&amp; Functioncall \rightarrow ID(expList) \\<br>&amp;  \\<br>&amp; expList \rightarrow exp \\<br>&amp; expList \rightarrow expList,exp \\<br>&amp;  \\<br>&amp; Arithmetic \rightarrow exp + exp \\<br>&amp; Arithmetic \rightarrow exp - exp \\<br>&amp; Arithmetic \rightarrow exp \times exp \\<br>&amp; Arithmetic \rightarrow exp / exp \\<br>&amp;  \\<br>&amp; Comparison \rightarrow exp = exp \\<br>&amp; Comparison \rightarrow exp \neq  exp \\<br>&amp; Comparison \rightarrow exp \leq exp \\<br>&amp; Comparison \rightarrow exp \geq exp \\<br>&amp; Comparison \rightarrow exp &lt; exp \\<br>&amp; Comparison \rightarrow exp &gt; exp \\<br>&amp;  \\<br>&amp; RecordCreation \rightarrow ID{} \\<br>&amp; RecordCreation \rightarrow ID{FieldAssignmentList} \\<br>&amp;  \\<br>&amp; FieldAssignmentList \rightarrow FieldAssignment \\<br>&amp; FieldAssignmentList \rightarrow FieldAssignmentList,FieldAssignment \\<br>&amp;  \\<br>&amp; FieldAssignment \rightarrow ID = exp \\<br>&amp;  \\<br>&amp; ArrayCreation \rightarrow ID [exp] OF exp \\<br>xp &gt; exp \\<br>&amp;  \\<br>&amp; RecordCreation \rightarrow ID{} \\<br>&amp; RecordCreation \rightarrow ID{FieldAssignmentList} \\<br>&amp;  \\<br>&amp; FieldAssignmentList \rightarrow FieldAssignment \\<br>&amp; FieldAssignmentList \rightarrow FieldAssignmentList,FieldAssignment \\<br>&amp;  \\<br>&amp; FieldAssignment \rightarrow ID = exp \\<br>&amp;  \\<br>&amp; ArrayCreation \rightarrow ID [exp] OF \quad exp \\<br>\end{align}<br>$$<br>error是在Bison中定义好的，所以我们不需要再次声明直接使用即可。</p>
<h4 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h4><p>1.<a href="https://www.gnu.org/software/bison/manual/bison.html" target="_blank" rel="noopener">Bison文档</a></p>
<p>2.<a href="https://github.com/geeeeeeeeek/tiger/tree/master/lab3/project-3" target="_blank" rel="noopener">geeeeeeeeek/tiger</a></p>
<p>3.<a href="https://stackoverflow.com/questions/26968665/bison-shift-reduce-conflict-tiger-compiler" target="_blank" rel="noopener">stackoverflow</a></p>
<p>4.<a href="https://www.gnu.org/software/bison/manual/html_node/Shift_002fReduce.html" target="_blank" rel="noopener">shift/reduce</a></p>
<p>5.<a href="https://www.gnu.org/software/bison/manual/html_node/Simple-GLR-Parsers.html" target="_blank" rel="noopener">Bison-Simple-GLR-Parsers</a></p>
<p>6.<a href="http://www.yinwang.org/blog-cn/2015/09/19/parser" target="_blank" rel="noopener">写了两周parser之后发现的一篇文章ps是垠哥写的，不要太在意</a></p>

            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">Jinzhengxu</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="http://jinzhengxu.github.io/2019/04/01/xian-dai-bian-yi-yuan-li-c-yu-yan-miao-shu-3/">http://jinzhengxu.github.io/2019/04/01/xian-dai-bian-yi-yuan-li-c-yu-yan-miao-shu-3/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">Jinzhengxu</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/编译原理/">
                                    <span class="chip bg-color">编译原理</span>
                                </a>
                            
                                <a href="/tags/虎书/">
                                    <span class="chip bg-color">虎书</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    
        <style>
    .valine-card {
        margin: 1.5rem auto;
    }

    .valine-card .card-content {
        padding: 20px 20px 5px 20px;
    }

    #vcomments textarea {
        box-sizing: border-box;
        background: url("/medias/comment_bg.png") 100% 100% no-repeat;
    }

    #vcomments p {
        margin: 2px 2px 10px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }

    #vcomments blockquote p {
        text-indent: 0.2rem;
    }

    #vcomments a {
        padding: 0 2px;
        color: #4cbf30;
        font-weight: 500;
        text-decoration: none;
    }

    #vcomments img {
        max-width: 100%;
        height: auto;
        cursor: pointer;
    }

    #vcomments ol li {
        list-style-type: decimal;
    }

    #vcomments ol,
    ul {
        display: block;
        padding-left: 2em;
        word-spacing: 0.05rem;
    }

    #vcomments ul li,
    ol li {
        display: list-item;
        line-height: 1.8rem;
        font-size: 1rem;
    }

    #vcomments ul li {
        list-style-type: disc;
    }

    #vcomments ul ul li {
        list-style-type: circle;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    #vcomments table, th, td {
        border: 0;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments h1 {
        font-size: 1.85rem;
        font-weight: bold;
        line-height: 2.2rem;
    }

    #vcomments h2 {
        font-size: 1.65rem;
        font-weight: bold;
        line-height: 1.9rem;
    }

    #vcomments h3 {
        font-size: 1.45rem;
        font-weight: bold;
        line-height: 1.7rem;
    }

    #vcomments h4 {
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    #vcomments h5 {
        font-size: 1.1rem;
        font-weight: bold;
        line-height: 1.4rem;
    }

    #vcomments h6 {
        font-size: 1rem;
        line-height: 1.3rem;
    }

    #vcomments p {
        font-size: 1rem;
        line-height: 1.5rem;
    }

    #vcomments hr {
        margin: 12px 0;
        border: 0;
        border-top: 1px solid #ccc;
    }

    #vcomments blockquote {
        margin: 15px 0;
        border-left: 5px solid #42b983;
        padding: 1rem 0.8rem 0.3rem 0.8rem;
        color: #666;
        background-color: rgba(66, 185, 131, .1);
    }

    #vcomments pre {
        font-family: monospace, monospace;
        padding: 1.2em;
        margin: .5em 0;
        background: #272822;
        overflow: auto;
        border-radius: 0.3em;
        tab-size: 4;
    }

    #vcomments code {
        font-family: monospace, monospace;
        padding: 1px 3px;
        font-size: 0.92rem;
        color: #e96900;
        background-color: #f8f8f8;
        border-radius: 2px;
    }

    #vcomments pre code {
        font-family: monospace, monospace;
        padding: 0;
        color: #e8eaf6;
        background-color: #272822;
    }

    #vcomments pre[class*="language-"] {
        padding: 1.2em;
        margin: .5em 0;
    }

    #vcomments code[class*="language-"],
    pre[class*="language-"] {
        color: #e8eaf6;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    #vcomments b,
    strong {
        font-weight: bold;
    }

    #vcomments dfn {
        font-style: italic;
    }

    #vcomments small {
        font-size: 85%;
    }

    #vcomments cite {
        font-style: normal;
    }

    #vcomments mark {
        background-color: #fcf8e3;
        padding: .2em;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }
</style>

<div class="card valine-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; padding-left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="vcomments" class="card-content" style="display: grid">
    </div>
</div>

<script src="/libs/valine/av-min.js"></script>
<script src="/libs/valine/Valine.min.js"></script>
<script>
    new Valine({
        el: '#vcomments',
        appId: '7C9WIr1xTDwYs88TkPA1W0ua-gzGzoHsz',
        appKey: 'AzaMuy0kYyiPgMrnYKQALlNS',
        notify: 'false' === 'true',
        verify: 'false' === 'true',
        visitor: 'true' === 'true',
        avatar: 'mm',
        pageSize: '10',
        lang: 'zh-cn',
        placeholder: 'just go go'
    });
</script>

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2019/04/03/niao-ge-de-linux-si-fang-cai-4-linux-ci-pan-yu-wen-jian-xi-tong-guan-li/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/17.jpg" class="responsive-img" alt="Linux(4)-Linux磁盘与文件系统管理">
                        
                        <span class="card-title">Linux(4)-Linux磁盘与文件系统管理</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            认识Linux文件系统Linux 文件系统最“正统”的是 ext2 ,文件系统的建立和磁盘的物理结构是紧密相关的，现在我们有TB级的磁盘阵列，也有读写速度极快的ssd，如何根据自己的要求和期望的性能，文件系统的选择至关重要。
磁盘组成与分区
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2019-04-04
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/底层/" class="post-category">
                                    底层
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Linux/">
                        <span class="chip bg-color">Linux</span>
                    </a>
                    
                    <a href="/tags/文件系统/">
                        <span class="chip bg-color">文件系统</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2019/03/29/ubuntu-latex-vim-shi-shang-zui-qiang-note/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/1.jpg" class="responsive-img" alt="Ubuntu+LaTeX+Vim史上最强Note">
                        
                        <span class="card-title">Ubuntu+LaTeX+Vim史上最强Note</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            自从被种草Markdown以后，真的是大大提升了效率。但是每次碰上$ \LaTeX $还是会gg，但是看了国外的一位老哥上课$\LaTeX$比老师板书都快，真的很羡慕啊，但是也舍弃不了Spacevim的便利，这里就尝试一下，如何使用spac
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2019-03-29
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/软件工具/" class="post-category">
                                    软件工具
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Linux/">
                        <span class="chip bg-color">Linux</span>
                    </a>
                    
                    <a href="/tags/vim/">
                        <span class="chip bg-color">vim</span>
                    </a>
                    
                    <a href="/tags/LaTeX/">
                        <span class="chip bg-color">LaTeX</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


<!-- 代码块折行 -->

<style type="text/css">
code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }
</style>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>


<script src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script>
    MathJax.Hub.Config({
        tex2jax: {inlineMath: [['$', '$'], ['\(', '\)']]}
    });
</script>



    <footer class="page-footer bg-color">
    
    <div class="container row center-align" style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            <span id="year">2019</span>
            <a href="/about" target="_blank">Jinzhengxu</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/Jinzhengxu" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:jzxttzdq@gmail.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>









    <a href="https://icpc.baylor.edu/ICPCID/0OD0ZXI7SQQL" class="tooltipped" target="_blank" data-tooltip="我的ICPCID: https://icpc.baylor.edu/ICPCID/0OD0ZXI7SQQL" data-position="top" data-delay="50">
        <i class="fas fa-lightbulb"></i>
    </a>





    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("/search.xml", 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    
    <script type="text/javascript" color="0,0,255"
        pointColor="0,0,255" opacity='0.7'
        zIndex="-1" count="99"
        src="/libs/background/canvas-nest.js"></script>
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
